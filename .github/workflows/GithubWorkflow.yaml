name: github_workflow
on:
- push

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Run Trivy vulnerability scanner in repo mode
      uses: aquasecurity/trivy-action@master
      with:
        scan-type: 'fs'
        ignore-unfixed: true
        format: 'table'
        output: 'report.txt'
        severity: 'CRITICAL,HIGH'
        exit-code: 0

    - name: Check Trivy Scan Status
      run: exit ${{ steps. trivy-scan.outputs.exit_code }}
      continue-on-error: true

    - name: directory
      run: echo "$(ls -l)"

    - name: Send Report to Slack
      uses: MeilCli/slack-upload-file@v3
      id: report
      with:
        slack_token: ${{ secrets.SLACK_TOKEN }}
        channel_id: ${{ secrets.SLACK_CHANNEL_ID }}
        text: "$(cat report.txt)"
        file_path: 'report.txt'
        initial_comment: 'post by slack-upload-file'

    - name: Slack Notification
      uses: rtCamp/action-slack-notify@v2
      env:
        SLACK_CHANNEL: general
        SLACK_USERNAME: CX23333333
        SLACK_COLOR: danger
        SLACK_MESSAGE: "Cheng Xi"
        SLACK_TITLE: Name
        SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}

